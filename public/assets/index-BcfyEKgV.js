(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();(()=>{const m={};let e=null;const n=(l,t,i)=>{m[l]={selector:t,init:i}},o=()=>{Object.entries(m).forEach(([l,{selector:t,init:i}])=>{document.querySelectorAll(t).forEach(i)})},s=l=>{l.nodeType===Node.ELEMENT_NODE&&Object.entries(m).forEach(([t,{selector:i,init:c}])=>{l.matches(i)&&c(l),l.querySelectorAll(i).forEach(c)})},r=()=>{e||(e=new MutationObserver(l=>{l.forEach(t=>{t.addedNodes.forEach(s)})}),e.observe(document.body,{childList:!0,subtree:!0}))},a=()=>{e&&(e.disconnect(),e=null)},u=l=>{const t=m[l];if(!t){console.warn(`Component '${l}' not found in registry`);return}const i=`data-${l}-initialized`;document.querySelectorAll(`[${i}]`).forEach(c=>{c.removeAttribute(i)}),document.querySelectorAll(t.selector).forEach(t.init)},f=()=>{Object.entries(m).forEach(([l,{selector:t}])=>{const i=`data-${l}-initialized`;document.querySelectorAll(`[${i}]`).forEach(c=>{c.removeAttribute(i)})}),o()};window.basecoat={register:n,init:u,initAll:f,start:r,stop:a},document.addEventListener("DOMContentLoaded",()=>{o(),r()})})();(()=>{const m=e=>{const n=e.querySelector("header input"),o=e.querySelector('[role="menu"]');if(!n||!o){const i=[];n||i.push("input"),o||i.push("menu"),console.error(`Command component initialization failed. Missing element(s): ${i.join(", ")}`,e);return}const s=Array.from(o.querySelectorAll('[role="menuitem"]')),r=s.filter(i=>!i.hasAttribute("disabled")&&i.getAttribute("aria-disabled")!=="true");let a=[...r],u=-1;const f=i=>{if(u>-1&&r[u]&&r[u].classList.remove("active"),u=i,u>-1){const c=r[u];c.classList.add("active"),c.id?n.setAttribute("aria-activedescendant",c.id):n.removeAttribute("aria-activedescendant")}else n.removeAttribute("aria-activedescendant")},l=()=>{const i=n.value.trim().toLowerCase();f(-1),a=[],s.forEach(c=>{if(c.hasAttribute("data-force")){c.setAttribute("aria-hidden","false"),r.includes(c)&&a.push(c);return}const g=(c.dataset.filter||c.textContent).trim().toLowerCase(),w=(c.dataset.keywords||"").toLowerCase().split(/[\s,]+/).filter(Boolean).some(I=>I.includes(i)),y=g.includes(i)||w;c.setAttribute("aria-hidden",String(!y)),y&&r.includes(c)&&a.push(c)}),a.length>0&&(f(r.indexOf(a[0])),a[0].scrollIntoView({block:"nearest"}))};n.addEventListener("input",l);const t=i=>{if(!["ArrowDown","ArrowUp","Enter","Home","End"].includes(i.key))return;if(i.key==="Enter"){i.preventDefault(),u>-1&&r[u]?.click();return}if(a.length===0)return;i.preventDefault();const c=u>-1?a.indexOf(r[u]):-1;let g=c;switch(i.key){case"ArrowDown":c<a.length-1&&(g=c+1);break;case"ArrowUp":c>0?g=c-1:c===-1&&(g=0);break;case"Home":g=0;break;case"End":g=a.length-1;break}if(g!==c){const b=a[g];f(r.indexOf(b)),b.scrollIntoView({block:"nearest",behavior:"smooth"})}};o.addEventListener("mousemove",i=>{const c=i.target.closest('[role="menuitem"]');if(c&&a.includes(c)){const g=r.indexOf(c);g!==u&&f(g)}}),o.addEventListener("click",i=>{const c=i.target.closest('[role="menuitem"]');if(c&&a.includes(c)){const g=e.closest("dialog.command-dialog");g&&!c.hasAttribute("data-keep-command-open")&&g.close()}}),n.addEventListener("keydown",t),a.length>0&&(f(r.indexOf(a[0])),a[0].scrollIntoView({block:"nearest"})),e.dataset.commandInitialized=!0,e.dispatchEvent(new CustomEvent("basecoat:initialized"))};window.basecoat&&window.basecoat.register("command",".command:not([data-command-initialized])",m)})();(()=>{const m=e=>{const n=e.querySelector(":scope > button"),o=e.querySelector(":scope > [data-popover]"),s=o.querySelector('[role="menu"]');if(!n||!s||!o){const t=[];n||t.push("trigger"),s||t.push("menu"),o||t.push("popover"),console.error(`Dropdown menu initialisation failed. Missing element(s): ${t.join(", ")}`,e);return}let r=[],a=-1;const u=(t=!0)=>{n.getAttribute("aria-expanded")!=="false"&&(n.setAttribute("aria-expanded","false"),n.removeAttribute("aria-activedescendant"),o.setAttribute("aria-hidden","true"),t&&n.focus(),l(-1))},f=(t=!1)=>{document.dispatchEvent(new CustomEvent("basecoat:popover",{detail:{source:e}})),n.setAttribute("aria-expanded","true"),o.setAttribute("aria-hidden","false"),r=Array.from(s.querySelectorAll('[role^="menuitem"]')).filter(i=>!i.hasAttribute("disabled")&&i.getAttribute("aria-disabled")!=="true"),r.length>0&&t&&(t==="first"?l(0):t==="last"&&l(r.length-1))},l=t=>{if(a>-1&&r[a]&&r[a].classList.remove("active"),a=t,a>-1&&r[a]){const i=r[a];i.classList.add("active"),n.setAttribute("aria-activedescendant",i.id)}else n.removeAttribute("aria-activedescendant")};n.addEventListener("click",()=>{n.getAttribute("aria-expanded")==="true"?u():f(!1)}),e.addEventListener("keydown",t=>{const i=n.getAttribute("aria-expanded")==="true";if(t.key==="Escape"){i&&u();return}if(!i){["Enter"," "].includes(t.key)?(t.preventDefault(),f(!1)):t.key==="ArrowDown"?(t.preventDefault(),f("first")):t.key==="ArrowUp"&&(t.preventDefault(),f("last"));return}if(r.length===0)return;let c=a;switch(t.key){case"ArrowDown":t.preventDefault(),c=a===-1?0:Math.min(a+1,r.length-1);break;case"ArrowUp":t.preventDefault(),c=a===-1?r.length-1:Math.max(a-1,0);break;case"Home":t.preventDefault(),c=0;break;case"End":t.preventDefault(),c=r.length-1;break;case"Enter":case" ":t.preventDefault(),r[a]?.click(),u();return}c!==a&&l(c)}),s.addEventListener("mousemove",t=>{const i=t.target.closest('[role^="menuitem"]');if(i&&r.includes(i)){const c=r.indexOf(i);c!==a&&l(c)}}),s.addEventListener("mouseleave",()=>{l(-1)}),s.addEventListener("click",t=>{t.target.closest('[role^="menuitem"]')&&u()}),document.addEventListener("click",t=>{e.contains(t.target)||u()}),document.addEventListener("basecoat:popover",t=>{t.detail.source!==e&&u(!1)}),e.dataset.dropdownMenuInitialized=!0,e.dispatchEvent(new CustomEvent("basecoat:initialized"))};window.basecoat&&window.basecoat.register("dropdown-menu",".dropdown-menu:not([data-dropdown-menu-initialized])",m)})();(()=>{const m=e=>{const n=e.querySelector(":scope > button"),o=e.querySelector(":scope > [data-popover]");if(!n||!o){const a=[];n||a.push("trigger"),o||a.push("content"),console.error(`Popover initialisation failed. Missing element(s): ${a.join(", ")}`,e);return}const s=(a=!0)=>{n.getAttribute("aria-expanded")!=="false"&&(n.setAttribute("aria-expanded","false"),o.setAttribute("aria-hidden","true"),a&&n.focus())},r=()=>{document.dispatchEvent(new CustomEvent("basecoat:popover",{detail:{source:e}}));const a=o.querySelector("[autofocus]");a&&o.addEventListener("transitionend",()=>{a.focus()},{once:!0}),n.setAttribute("aria-expanded","true"),o.setAttribute("aria-hidden","false")};n.addEventListener("click",()=>{n.getAttribute("aria-expanded")==="true"?s():r()}),e.addEventListener("keydown",a=>{a.key==="Escape"&&s()}),document.addEventListener("click",a=>{e.contains(a.target)||s()}),document.addEventListener("basecoat:popover",a=>{a.detail.source!==e&&s(!1)}),e.dataset.popoverInitialized=!0,e.dispatchEvent(new CustomEvent("basecoat:initialized"))};window.basecoat&&window.basecoat.register("popover",".popover:not([data-popover-initialized])",m)})();(()=>{const m=e=>{const n=e.querySelector(":scope > button"),o=n.querySelector(":scope > span"),s=e.querySelector(":scope > [data-popover]"),r=s.querySelector('[role="listbox"]'),a=e.querySelector(':scope > input[type="hidden"]'),u=e.querySelector('header input[type="text"]');if(!n||!s||!r||!a){const d=[];n||d.push("trigger"),s||d.push("popover"),r||d.push("listbox"),a||d.push("input"),console.error(`Select component initialisation failed. Missing element(s): ${d.join(", ")}`,e);return}const f=Array.from(r.querySelectorAll('[role="option"]')),l=f.filter(d=>d.getAttribute("aria-disabled")!=="true");let t=[...l],i=-1;const c=d=>{if(i>-1&&l[i]&&l[i].classList.remove("active"),i=d,i>-1){const v=l[i];v.classList.add("active"),v.id?n.setAttribute("aria-activedescendant",v.id):n.removeAttribute("aria-activedescendant")}else n.removeAttribute("aria-activedescendant")},g=()=>{const d=getComputedStyle(s);return parseFloat(d.transitionDuration)>0||parseFloat(d.transitionDelay)>0},b=(d,v=!0)=>{if(d&&(o.innerHTML=d.innerHTML,a.value=d.dataset.value,r.querySelector('[role="option"][aria-selected="true"]')?.removeAttribute("aria-selected"),d.setAttribute("aria-selected","true"),v)){const h=new CustomEvent("change",{detail:{value:d.dataset.value},bubbles:!0});e.dispatchEvent(h)}},w=(d=!0)=>{if(s.getAttribute("aria-hidden")!=="true"){if(u){const v=()=>{u.value="",t=[...l],f.forEach(h=>h.setAttribute("aria-hidden","false"))};g()?s.addEventListener("transitionend",v,{once:!0}):v()}d&&n.focus(),s.setAttribute("aria-hidden","true"),n.setAttribute("aria-expanded","false"),c(-1)}},y=d=>{if(!d)return;const v=a.value,h=d.dataset.value;h!=null&&h!==v&&b(d),w()},I=d=>{const v=l.find(h=>h.dataset.value===d);y(v)};if(u){const d=()=>{const v=u.value.trim().toLowerCase();c(-1),t=[],f.forEach(h=>{if(h.hasAttribute("data-force")){h.setAttribute("aria-hidden","false"),l.includes(h)&&t.push(h);return}const E=(h.dataset.filter||h.textContent).trim().toLowerCase(),B=(h.dataset.keywords||"").toLowerCase().split(/[\s,]+/).filter(Boolean).some(D=>D.includes(v)),T=E.includes(v)||B;h.setAttribute("aria-hidden",String(!T)),T&&l.includes(h)&&t.push(h)})};u.addEventListener("input",d)}let L=l.find(d=>d.dataset.value===a.value);L||(L=l.find(d=>d.dataset.value!==void 0)??l[0]),b(L,!1);const k=d=>{const v=s.getAttribute("aria-hidden")==="false";if(!["ArrowDown","ArrowUp","Enter","Home","End","Escape"].includes(d.key))return;if(!v){d.key!=="Enter"&&d.key!=="Escape"&&(d.preventDefault(),n.click());return}if(d.preventDefault(),d.key==="Escape"){w();return}if(d.key==="Enter"){i>-1&&y(l[i]);return}if(t.length===0)return;const h=i>-1?t.indexOf(l[i]):-1;let E=h;switch(d.key){case"ArrowDown":h<t.length-1&&(E=h+1);break;case"ArrowUp":h>0?E=h-1:h===-1&&(E=0);break;case"Home":E=0;break;case"End":E=t.length-1;break}if(E!==h){const A=t[E];c(l.indexOf(A)),A.scrollIntoView({block:"nearest",behavior:"smooth"})}};r.addEventListener("mousemove",d=>{const v=d.target.closest('[role="option"]');if(v&&t.includes(v)){const h=l.indexOf(v);h!==i&&c(h)}}),r.addEventListener("mouseleave",()=>{const d=r.querySelector('[role="option"][aria-selected="true"]');c(d?l.indexOf(d):-1)}),n.addEventListener("keydown",k),u&&u.addEventListener("keydown",k);const x=()=>{document.dispatchEvent(new CustomEvent("basecoat:popover",{detail:{source:e}})),u&&(g()?s.addEventListener("transitionend",()=>{u.focus()},{once:!0}):u.focus()),s.setAttribute("aria-hidden","false"),n.setAttribute("aria-expanded","true");const d=r.querySelector('[role="option"][aria-selected="true"]');d&&(c(l.indexOf(d)),d.scrollIntoView({block:"nearest"}))};n.addEventListener("click",()=>{n.getAttribute("aria-expanded")==="true"?w():x()}),r.addEventListener("click",d=>{const v=d.target.closest('[role="option"]');v&&y(v)}),document.addEventListener("click",d=>{e.contains(d.target)||w(!1)}),document.addEventListener("basecoat:popover",d=>{d.detail.source!==e&&w(!1)}),s.setAttribute("aria-hidden","true"),e.selectByValue=I,e.dataset.selectInitialized=!0,e.dispatchEvent(new CustomEvent("basecoat:initialized"))};window.basecoat&&window.basecoat.register("select","div.select:not([data-select-initialized])",m)})();(()=>{if(!window.history.__basecoatPatched){const e=window.history.pushState;window.history.pushState=function(...o){e.apply(this,o),window.dispatchEvent(new Event("basecoat:locationchange"))};const n=window.history.replaceState;window.history.replaceState=function(...o){n.apply(this,o),window.dispatchEvent(new Event("basecoat:locationchange"))},window.history.__basecoatPatched=!0}const m=e=>{const n=e.dataset.initialOpen!=="false",o=e.dataset.initialMobileOpen==="true",s=parseInt(e.dataset.breakpoint)||768;let r=s>0?window.innerWidth>=s?n:o:n;const a=()=>{const t=window.location.pathname.replace(/\/$/,"");e.querySelectorAll("a").forEach(i=>{if(i.hasAttribute("data-ignore-current"))return;new URL(i.href).pathname.replace(/\/$/,"")===t?i.setAttribute("aria-current","page"):i.removeAttribute("aria-current")})},u=()=>{e.setAttribute("aria-hidden",!r),r?e.removeAttribute("inert"):e.setAttribute("inert","")},f=t=>{r=t,u()},l=e.id;document.addEventListener("basecoat:sidebar",t=>{if(!(t.detail?.id&&t.detail.id!==l))switch(t.detail?.action){case"open":f(!0);break;case"close":f(!1);break;default:f(!r);break}}),e.addEventListener("click",t=>{const i=t.target,c=e.querySelector("nav");if(window.innerWidth<s&&i.closest("a, button")&&!i.closest("[data-keep-mobile-sidebar-open]")){document.activeElement&&document.activeElement.blur(),f(!1);return}(i===e||c&&!c.contains(i))&&(document.activeElement&&document.activeElement.blur(),f(!1))}),window.addEventListener("popstate",a),window.addEventListener("basecoat:locationchange",a),u(),a(),e.dataset.sidebarInitialized=!0,e.dispatchEvent(new CustomEvent("basecoat:initialized"))};window.basecoat&&window.basecoat.register("sidebar",".sidebar:not([data-sidebar-initialized])",m)})();(()=>{const m=e=>{const n=e.querySelector('[role="tablist"]');if(!n)return;const o=Array.from(n.querySelectorAll('[role="tab"]')),s=o.map(a=>document.getElementById(a.getAttribute("aria-controls"))).filter(Boolean),r=a=>{o.forEach((f,l)=>{f.setAttribute("aria-selected","false"),f.setAttribute("tabindex","-1"),s[l]&&(s[l].hidden=!0)}),a.setAttribute("aria-selected","true"),a.setAttribute("tabindex","0");const u=document.getElementById(a.getAttribute("aria-controls"));u&&(u.hidden=!1)};n.addEventListener("click",a=>{const u=a.target.closest('[role="tab"]');u&&r(u)}),n.addEventListener("keydown",a=>{const u=a.target;if(!o.includes(u))return;let f;const l=o.indexOf(u);switch(a.key){case"ArrowRight":f=o[(l+1)%o.length];break;case"ArrowLeft":f=o[(l-1+o.length)%o.length];break;case"Home":f=o[0];break;case"End":f=o[o.length-1];break;default:return}a.preventDefault(),r(f),f.focus()}),e.dataset.tabsInitialized=!0,e.dispatchEvent(new CustomEvent("basecoat:initialized"))};window.basecoat&&window.basecoat.register("tabs",".tabs:not([data-tabs-initialized])",m)})();(()=>{let m;const e=new WeakMap;let n=!1;const o={success:'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>',error:'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>',info:'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>',warning:'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>'};function s(t){t.dataset.toasterInitialized||(m=t,m.addEventListener("mouseenter",a),m.addEventListener("mouseleave",u),m.addEventListener("click",i=>{const c=i.target.closest(".toast footer a"),g=i.target.closest(".toast footer button");(c||g)&&f(i.target.closest(".toast"))}),m.querySelectorAll(".toast:not([data-toast-initialized])").forEach(r),m.dataset.toasterInitialized="true",m.dispatchEvent(new CustomEvent("basecoat:initialized")))}function r(t){if(t.dataset.toastInitialized)return;const i=parseInt(t.dataset.duration),c=i!==-1?i||(t.dataset.category==="error"?5e3:3e3):-1,g={remainingTime:c,timeoutId:null,startTime:null};c!==-1&&(n?g.timeoutId=null:(g.startTime=Date.now(),g.timeoutId=setTimeout(()=>f(t),c))),e.set(t,g),t.dataset.toastInitialized="true"}function a(){n||(n=!0,m.querySelectorAll('.toast:not([aria-hidden="true"])').forEach(t=>{if(!e.has(t))return;const i=e.get(t);i.timeoutId&&(clearTimeout(i.timeoutId),i.timeoutId=null,i.remainingTime-=Date.now()-i.startTime)}))}function u(){n&&(n=!1,m.querySelectorAll('.toast:not([aria-hidden="true"])').forEach(t=>{if(!e.has(t))return;const i=e.get(t);i.remainingTime!==-1&&!i.timeoutId&&(i.remainingTime>0?(i.startTime=Date.now(),i.timeoutId=setTimeout(()=>f(t),i.remainingTime)):f(t))}))}function f(t){if(!e.has(t))return;const i=e.get(t);clearTimeout(i.timeoutId),e.delete(t),t.contains(document.activeElement)&&document.activeElement.blur(),t.setAttribute("aria-hidden","true"),t.addEventListener("transitionend",()=>t.remove(),{once:!0})}function l(t){const{category:i="info",title:c,description:g,action:b,cancel:w,duration:y,icon:I}=t,L=I||i&&o[i]||"",k=c?`<h2>${c}</h2>`:"",x=g?`<p>${g}</p>`:"",d=b?.href?`<a href="${b.href}" class="btn" data-toast-action>${b.label}</a>`:b?.onclick?`<button type="button" class="btn" data-toast-action onclick="${b.onclick}">${b.label}</button>`:"",v=w?`<button type="button" class="btn-outline h-6 text-xs px-2.5 rounded-sm" data-toast-cancel onclick="${w?.onclick}">${w.label}</button>`:"",h=d||v?`<footer>${d}${v}</footer>`:"",E=`
      <div
        class="toast"
        role="${i==="error"?"alert":"status"}"
        aria-atomic="true"
        ${i?`data-category="${i}"`:""}
        ${y!==void 0?`data-duration="${y}"`:""}
      >
        <div class="toast-content">
          ${L}
          <section>
            ${k}
            ${x}
          </section>
          ${h}
          </div>
        </div>
      </div>
    `,A=document.createElement("template");return A.innerHTML=E.trim(),A.content.firstChild}document.addEventListener("basecoat:toast",t=>{if(!m){console.error("Cannot create toast: toaster container not found on page.");return}const i=t.detail?.config||{},c=l(i);m.appendChild(c)}),window.basecoat&&(window.basecoat.register("toaster","#toaster:not([data-toaster-initialized])",s),window.basecoat.register("toast",".toast:not([data-toast-initialized])",r))})();class p{static YIN=0;static YANG=1;static FIXED="fixed";static MUTANT="mutant";constructor(e){this.lines=e}static mutateHexagram(e){const n=e.lines.map(o=>o[1]===p.MUTANT?[o[0]===p.YANG?p.YIN:p.YANG,p.FIXED]:o);return new p(n)}getBinaryString(){return this.lines.map(e=>e[0]).join("")}hasMutantLines(){return this.lines.some(e=>e[1]===p.MUTANT)}getMutantLineIndices(){return this.lines.reduce((e,n,o)=>(n[1]===p.MUTANT&&e.push(o+1),e),[])}getString(){return this.lines.map(e=>{if(e[0]===p.YIN&&e[1]===p.MUTANT)return"6";if(e[0]===p.YANG&&e[1]===p.MUTANT)return"9";if(e[0]===p.YANG&&e[1]===p.FIXED)return"7";if(e[0]===p.YIN&&e[1]===p.FIXED)return"8"}).join("")}getBinaryStringWithMutantLine(){const e=this.getBinaryString(),n=this.getMutantLineIndices().join("");return n?`${e}-${n}`:e}}class ${constructor(){this.hexagram=null,this.currentLine=0}tossCoin(){return Math.random()<.5?2:3}readLine(){const e=[this.tossCoin(),this.tossCoin(),this.tossCoin()];O(e);const n=e.reduce((o,s)=>o+s,0);switch(n){case 6:return[p.YIN,p.MUTANT];case 7:return[p.YANG,p.FIXED];case 8:return[p.YIN,p.FIXED];case 9:return[p.YANG,p.MUTANT];default:throw new Error(`Invalid sum: ${n}`)}}startDivination(){this.hexagram=null,this.currentLine=0}tossCoins(){if(this.currentLine<6){const e=this.readLine();return this.hexagram||(this.hexagram=new p([])),this.hexagram.lines.push(e),this.currentLine++,!0}return!1}isComplete(){return this.currentLine===6}getHexagram(){return this.hexagram}}class S{static renderHexagram(e,n){const o=document.getElementById(n);o.innerHTML="",e.lines.forEach(s=>{const r=document.createElement("div");if(r.className="hexagram-line position-relative",s[0]===p.YANG){const a=document.createElement("div");a.className="yang",r.appendChild(a)}else{const a=document.createElement("div"),u=document.createElement("div");a.className="yin",u.className="yin",r.appendChild(a),r.appendChild(u)}s[1]===p.MUTANT&&r.classList.add("mutant"),o.prepend(r)})}}function M(m){const e=["coin-1","coin-2","coin-3"];m.forEach((n,o)=>{const s=document.getElementById(e[o]),r=n===2?"yang":"ying";s.innerHTML=`<img src="coin-${r}.svg" alt="${r}" />`})}function O(m){const e=["coin-1","coin-2","coin-3"];e.forEach(n=>{document.getElementById(n).classList.add("coin-flipping")}),setTimeout(()=>{e.forEach((n,o)=>{const s=document.getElementById(n),r=m[o]===2?"yang":"ying";s.innerHTML=`<img src="coin-${r}.svg" alt="${r}" />`,s.classList.remove("coin-flipping")})},700)}class q{constructor(){this.reading=new $,this.tossButton=document.getElementById("toss-coin"),this.questionInput=document.getElementById("question"),this.loadingSpinner=document.getElementById("loading-spinner"),this.newReadingButton=document.getElementById("new-reading"),this.tossWrapper=document.getElementById("toss-coin-wrapper"),this.askAIContainer=document.getElementById("askai"),this.hexagramData=null,this.detailLevels={short:{label:"Courte",description:"Fournis un résumé très court avec l'essentiel du message."},medium:{label:"Moyenne",description:"Fournis un résumé de longueur moyenne en expliquant les points principaux."},detailed:{label:"Détaillée",description:"Décris l'hexagramme principal pour donner des conseils pertinents."}},this.aiOptions={chatgpt:{label:"Chat GPT",url:"https://chat.openai.com/"},mistral:{label:"Mistral AI",url:"https://chat.mistral.ai/chat/"},claude:{label:"Claude",url:"https://claude.ai/new"},gemini:{label:"Gemini",url:"https://gemini.google.com/app"}},this.tossButton.addEventListener("click",()=>this.onTossButtonClick()),this.newReadingButton.addEventListener("click",()=>this.reset()),this.initDetailLevelSelect(),this.initAISelect()}async start(){await this.loadData(),this.reset(),this.loadingSpinner.style.display="none";const e=document.getElementById("ai-choice"),n=document.getElementById("btn-askai"),o=()=>{const s=e.options[e.selectedIndex].text;n.textContent=`Faire interpréter par ${s}`};e.addEventListener("change",o),o()}initDetailLevelSelect(){const e=document.getElementById("detailLevel");for(const[n,{label:o}]of Object.entries(this.detailLevels)){const s=document.createElement("option");s.value=n,s.textContent=o,e.appendChild(s)}e.selectedIndex=1}initAISelect(){const e=document.getElementById("ai-choice");for(const[n,{label:o}]of Object.entries(this.aiOptions)){const s=document.createElement("option");s.value=n,s.textContent=o,e.appendChild(s)}}async loadData(){const n=await(await fetch("hexagrams.json")).json();this.hexagramData=n.hexagrams}onTossButtonClick(){this.questionInput.disabled=!0,this.reading.isComplete()||this.reading.tossCoins()&&(S.renderHexagram(this.reading.getHexagram(),"original-hexagram"),this.reading.isComplete()&&this.finalizeDivination())}async finalizeDivination(){_paq.push(["trackGoal",1]);const e=this.reading.getHexagram();if(e.hasMutantLines()){const n=p.mutateHexagram(e);S.renderHexagram(n,"mutated-hexagram"),await this.renderHexagramInfo(n,"title-mutated-hexagram")}else document.getElementById("title-mutated-hexagram").innerHTML="Pas de mutation";await this.renderHexagramInfo(e,"title-original-hexagram"),document.getElementById("toss-coin-wrapper").style.display="none",document.getElementById("new-reading").classList.remove("d-none"),document.getElementById("askai").style.display="block",document.getElementById("btn-askai").addEventListener("click",()=>this.onAskAIClick(e))}async renderHexagramInfo(e,n){const o=document.getElementById(n),s=this.hexagramData[e.getBinaryString()];s?o.innerHTML=`
      <strong>${s.number}.</strong> <strong>${s.name}</strong> (${s.ideogram})`:o.innerHTML="Informations non disponibles"}onAskAIClick(e){const n=document.getElementById("ai-choice").value,o=document.getElementById("detailLevel").value,s=this.detailLevels[o].description;_paq.push(["trackGoal",2]);const r=this.hexagramData[e.getBinaryString()].number;let a=this.questionInput.value.trim();a&&!a.endsWith(" ?")&&(a+="?"),a&&(a=`Question : ${a}, `);let u=`Interprète un tirage du Yi Jing en fonction des informations suivantes : ${a} Hexagramme principal : ${r}. ${s}`;if(e.hasMutantLines()){const t=p.mutateHexagram(e),i=this.hexagramData[t.getBinaryString()].number,c=e.getMutantLineIndices().join(", ");u=`Interprète un tirage du Yi Jing en fonction des informations suivantes : ${a} Hexagramme principal : ${r}, Lignes mutantes : ${c}, Hexagramme muté : ${i}. ${s}`}const f=encodeURIComponent(u);let l=this.aiOptions[n].url+`?q=${f}`;window.open(l,"_blank")}reset(){this.reading.startDivination(),this.questionInput.value="",this.questionInput.disabled=!1,document.getElementById("original-hexagram").innerHTML="",document.getElementById("mutated-hexagram").innerHTML="",document.getElementById("original-info").innerHTML="",document.getElementById("mutated-info").innerHTML="",document.getElementById("title-original-hexagram").textContent="Hex. Original",document.getElementById("title-mutated-hexagram").textContent="Hex. Muté",this.tossWrapper.style.display="block",this.askAIContainer.style.display="none",this.newReadingButton.classList.add("d-none"),this.tossButton.disabled=!1,M([3,3,3])}}document.addEventListener("DOMContentLoaded",async()=>{await new q().start()});
